{% extends "base.html" %}
{% block title %}New Climb Tracker -  Climbing Tracker{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/new_tracker.css">
{% endblock %}

{% block content %}

    <div class="body">
        <div class="new-tracker-container">
            <div class="new-tracker-heading">
                <h1>Create a New Climb Tracker</h1>
                <p>Fill in the details below to add a new climb to your tracker.</p>
            </div>
            <div class="new-tracker-form">
                <form action="/api/create_tracker" method="post" autocomplete="off">
                    <div class="form-group">
                        <label for="climb_name">Climb Name:</label>
                        <input type="text" id="climb_name" name="climb_name" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="grading_system">Grading System:</label>
                        <select id="grading_system" name="grading_system" required>
                            <option value="v_grade">V Grade</option>
                            <option value="font_grade">Font Grade</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="grade">Grade:</label>
                        <select id="grade" name="grade" required>
                    <!-- V grades (values uppercase) -->
                    <optgroup label="V Grade" class="v-grade-options">
                        <option class="v-option" value="VB">VB</option>
                        <option class="v-option" value="V0">V0</option>
                        <option class="v-option" value="V1">V1</option>
                        <option class="v-option" value="V2">V2</option>
                        <option class="v-option" value="V3">V3</option>
                        <option class="v-option" value="V4">V4</option>
                        <option class="v-option" value="V5">V5</option>
                        <option class="v-option" value="V6">V6</option>
                        <option class="v-option" value="V7">V7</option>
                        <option class="v-option" value="V8">V8</option>
                        <option class="v-option" value="V9">V9</option>
                        <option class="v-option" value="V10">V10</option>
                        <option class="v-option" value="V11">V11</option>
                        <option class="v-option" value="V12">V12</option>
                        <option class="v-option" value="V13">V13</option>
                        <option class="v-option" value="V14">V14</option>
                        <option class="v-option" value="V15">V15</option>
                        <option class="v-option" value="V16">V16</option>
                        <option class="v-option" value="V17">V17</option>
                    </optgroup>

                    <!-- Font grades (values lowercase) -->
                    <optgroup label="Font Grade" class="font-grade-options">
                        <option class="font-option" value="3">3</option>
                        <option class="font-option" value="3+">3+</option>
                        <option class="font-option" value="4">4</option>
                        <option class="font-option" value="4+">4+</option>
                        <option class="font-option" value="5">5</option>
                        <option class="font-option" value="5+">5+</option>
                        <option class="font-option" value="6a">6a</option>
                        <option class="font-option" value="6a+">6a+</option>
                        <option class="font-option" value="6b">6b</option>
                        <option class="font-option" value="6b+">6b+</option>
                        <option class="font-option" value="6c">6c</option>
                        <option class="font-option" value="6c+">6c+</option>
                        <option class="font-option" value="7a">7a</option>
                        <option class="font-option" value="7a+">7a+</option>
                        <option class="font-option" value="7b">7b</option>
                        <option class="font-option" value="7b+">7b+</option>
                        <option class="font-option" value="7c">7c</option>
                        <option class="font-option" value="7c+">7c+</option>
                        <option class="font-option" value="8a">8a</option>
                        <option class="font-option" value="8a+">8a+</option>
                        <option class="font-option" value="8b">8b</option>
                        <option class="font-option" value="8b+">8b+</option>
                        <option class="font-option" value="8c">8c</option>
                        <option class="font-option" value="8c+">8c+</option>
                        <option class="font-option" value="9a">9a</option>
                    </optgroup>
                    </select>
                    </div>

                    <div class="form-group">
                        <label for="date">Date:</label>
                        <input type="date" id="date" name="date">
                    </div>
                    
                    <div class="form-group">
                        <label for="description">Additional Notes (Optional):</label>
                        <textarea id="description" name="description" rows="3" placeholder="Any additional details about this climb..."></textarea>
                    </div>

                    <!-- Two-column row for attempts and completed -->
                    <div class="form-row-two-col">
                        <div class="form-group-inline">
                            <label for="attempts">Number of Attempts:</label>
                            <input type="number" id="attempts" name="attempts" min="1" value="1" required>
                        </div>
                        <div class="form-group-inline">
                            <label for="complete">Completed:</label>
                            <input type="checkbox" id="complete" name="complete">
                        </div>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary">Add Climb</button>
                        <a href="/user/my_tracker" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% block scripts %}
    <script>
    (function () {
        const gradingSystem = document.getElementById('grading_system');
        const gradeSelect = document.getElementById('grade');
        const vOptions = Array.from(document.querySelectorAll('.v-option'));
        const fontOptions = Array.from(document.querySelectorAll('.font-option'));

        function setSystem(system) {
        if (system === 'v_grade') {
            // show/enable V, hide/disable Font
            vOptions.forEach(opt => { opt.disabled = false; opt.hidden = false; });
            fontOptions.forEach(opt => { opt.disabled = true; opt.hidden = true; });

            // pick first enabled v option if current selection was font or invalid
            if (!gradeSelect.value || gradeSelect.value.toUpperCase().startsWith('V') === false) {
            const first = vOptions.find(o => !o.disabled);
            if (first) gradeSelect.value = first.value;
            }
        } else {
            // show/enable Font, hide/disable V
            fontOptions.forEach(opt => { opt.disabled = false; opt.hidden = false; });
            vOptions.forEach(opt => { opt.disabled = true; opt.hidden = true; });

            // pick first enabled font option if current selection was v or invalid
            if (!gradeSelect.value || gradeSelect.value.toUpperCase().startsWith('V')) {
            const first = fontOptions.find(o => !o.disabled);
            if (first) gradeSelect.value = first.value;
            }
        }
        // ensure required still works
        gradeSelect.required = true;
        }

        // initial setup on load
        setSystem(gradingSystem.value);

        // listen for changes
        gradingSystem.addEventListener('change', (e) => {
        setSystem(e.target.value);
        });
    })();
    </script>
    {% endblock%}
    {% endblock %}