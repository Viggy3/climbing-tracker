{% extends "base.html" %}

{% block title %}Dashboard - üßó Climbing Tracker{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" href="/static/css/dashboard.css">
{% endblock %}

{% block content %}
    <div>
        <div class="dashboard-container">
            <div class="dashboard-heading"></div>
                <h1>Dashboard</h1>
                <p>Welcome to your climbing dashboard! Here you can track your climbs and view your progress over time.</p>
            </div>
            <div class="stats-overview">

                <div class="stats-grid">

                    <div class="stat-card">
                        <h3>
                            {{ total_climbs }} 
                        </h3>
                        <p>Total Climbs</p>           
                    </div>

                    <div class="stat-card">
                        <h3>
                            {{ highest_grade }}
                        </h3>
                        <p>Highest Grade</p>
                    </div>

                </div>
            </div>
            <div class="new_climb">
                <a href="/api/new_tracker" class="btn btn-primary">Add Climb</a>
            </div>
                <!-- Pagination for trackers -->
                <div class="pagination">
                    {% if paginated_trackers%}
                        <div class = "tracker-list">
                            {% for climb in paginated_trackers%}
                            <div class="climb-item">

                                <div class="climb-header">
                                    <h3>{{ climb.name }}</h3>
                                    <div class="climb-actions">
                                        <a href="/api/edit_tracker/{{ climb.id }}" class="btn btn-secondary">Edit</a>
                                        <span class="grade-badge">{{ climb.grade }}</span>
                                    </div>
                                </div>
                                <p class="climb-description">{{ climb.description }}</p>
                                <div class="climb-details">
                                    <span class="climb-date"> {{ climb.date }}</span>
                                    <span class="climb-attempts"> {{ climb.attempts }} attempts</span>
                                    <span class="climb-status"> 
                                        {% if climb.complete%}
                                        <span class="status-complete"> Completed</span>
                                        {% else %}
                                        <span class="status-in-progress"> In Progress</span>
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                                {%endfor%}
                        </div>
                        <div class="pagination_buttons">
                            {% if current_page > 1 %}
                                <a href="?page={{ current_page - 1 }}&per_page={{ per_page }}" class="btn btn-secondary">‚Üê Previous</a>
                            {% else %}
                                <button class="btn btn-disabled" disabled>‚Üê Previous</button>
                            {% endif %}
                            
                            <span class="page-info">Page {{ current_page }} of {{ pages_total }}</span>
                            
                            {% if current_page < pages_total %}
                                <a href="?page={{ current_page + 1 }}&per_page={{ per_page }}" class="btn btn-secondary">Next ‚Üí</a>
                            {% else %}
                                <button class="btn btn-disabled" disabled>Next ‚Üí</button>
                            {% endif %}
                        </div>
                        
                        <!-- Page Numbers -->
                        {% if pages_total > 1 %}
                        <div class="page-numbers">
                            {% for page_num in range(1, pages_total + 1) %}
                                {% if page_num == current_page %}
                                    <span class="page-number active">{{ page_num }}</span>
                                {% else %}
                                    <a href="?page={{ page_num }}&per_page={{ per_page }}" class="page-number">{{ page_num }}</a>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <div class="per-page-select">
                            <label for="per_page">Climbs per page:</label>
                            <select id="per_page" name="per_page" onchange="changePerPage(this.value)">
                                <option value="5" {% if per_page == 5 %}selected{% endif %}>5</option>
                                <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                                <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                            </select>
                        </div>
                    {% endif%}
                    </div>
                </div>
        </div>
    </div>
 {% block extra_scripts%}
    <script>
    function changePerPage(newPerPage) {
        const currentUrl = new URL(window.location);
        currentUrl.searchParams.set('per_page', newPerPage);
        currentUrl.searchParams.set('page', '1'); // Reset to page 1 when changing per_page
        window.location.href = currentUrl.toString();
    }
    </script>
    {% endblock %}
{% endblock %}