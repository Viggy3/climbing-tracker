{% extends "base.html" %}

{% block title %}Edit Climb - ðŸ§— Climbing Tracker{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/new_tracker.css">
<link rel="stylesheet" href="/static/css/climb_details.css">
<link rel="stylesheet" href="/static/css/view_climb.css">
{% endblock %}

{% block content %}
    <div>
        <div class="climb_edit_form">
            <div class="climb-edit-heading">
                <h1>Edit Climb</h1>
                <p>Update your climb details below.</p>
            </div>
            <div class="climb-edit-container">
                <form action="/api/update_tracker/{{ climb._id }}" method="post">
                    
                    <div class="form-group">
                        <label for="grading_system">Grading System:</label>
                        <select id="grading_system" name="grading_system" required>
                            <option value="v_grade" {% if climb.grade and climb.grade.startswith('V') %}selected{% endif %}>V Grade</option>
                            <option value="font_grade" {% if climb.grade and not climb.grade.startswith('V') %}selected{% endif %}>Font Grade</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="edit_climb_grade">Grade:</label>
                        <select id="edit_climb_grade" name="edit_climb_grade">
                    <!-- V grades (values uppercase) -->
                    <optgroup label="V Grade" class="v-grade-options">
                        <option class="v-option" value="VB" {% if climb.grade == 'VB' %}selected{% endif %}>VB</option>
                        <option class="v-option" value="V0" {% if climb.grade == 'V0' %}selected{% endif %}>V0</option>
                        <option class="v-option" value="V1" {% if climb.grade == 'V1' %}selected{% endif %}>V1</option>
                        <option class="v-option" value="V2" {% if climb.grade == 'V2' %}selected{% endif %}>V2</option>
                        <option class="v-option" value="V3" {% if climb.grade == 'V3' %}selected{% endif %}>V3</option>
                        <option class="v-option" value="V4" {% if climb.grade == 'V4' %}selected{% endif %}>V4</option>
                        <option class="v-option" value="V5" {% if climb.grade == 'V5' %}selected{% endif %}>V5</option>
                        <option class="v-option" value="V6" {% if climb.grade == 'V6' %}selected{% endif %}>V6</option>
                        <option class="v-option" value="V7" {% if climb.grade == 'V7' %}selected{% endif %}>V7</option>
                        <option class="v-option" value="V8" {% if climb.grade == 'V8' %}selected{% endif %}>V8</option>
                        <option class="v-option" value="V9" {% if climb.grade == 'V9' %}selected{% endif %}>V9</option>
                        <option class="v-option" value="V10" {% if climb.grade == 'V10' %}selected{% endif %}>V10</option>
                        <option class="v-option" value="V11" {% if climb.grade == 'V11' %}selected{% endif %}>V11</option>
                        <option class="v-option" value="V12" {% if climb.grade == 'V12' %}selected{% endif %}>V12</option>
                        <option class="v-option" value="V13" {% if climb.grade == 'V13' %}selected{% endif %}>V13</option>
                        <option class="v-option" value="V14" {% if climb.grade == 'V14' %}selected{% endif %}>V14</option>
                        <option class="v-option" value="V15" {% if climb.grade == 'V15' %}selected{% endif %}>V15</option>
                        <option class="v-option" value="V16" {% if climb.grade == 'V16' %}selected{% endif %}>V16</option>
                        <option class="v-option" value="V17" {% if climb.grade == 'V17' %}selected{% endif %}>V17</option>
                    </optgroup>

                    <!-- Font grades (values lowercase) -->
                    <optgroup label="Font Grade" class="font-grade-options">
                        <option class="font-option" value="3" {% if climb.grade == '3' %}selected{% endif %}>3</option>
                        <option class="font-option" value="3+" {% if climb.grade == '3+' %}selected{% endif %}>3+</option>
                        <option class="font-option" value="4" {% if climb.grade == '4' %}selected{% endif %}>4</option>
                        <option class="font-option" value="4+" {% if climb.grade == '4+' %}selected{% endif %}>4+</option>
                        <option class="font-option" value="5" {% if climb.grade == '5' %}selected{% endif %}>5</option>
                        <option class="font-option" value="5+" {% if climb.grade == '5+' %}selected{% endif %}>5+</option>
                        <option class="font-option" value="6a" {% if climb.grade == '6a' %}selected{% endif %}>6a</option>
                        <option class="font-option" value="6a+" {% if climb.grade == '6a+' %}selected{% endif %}>6a+</option>
                        <option class="font-option" value="6b" {% if climb.grade == '6b' %}selected{% endif %}>6b</option>
                        <option class="font-option" value="6b+" {% if climb.grade == '6b+' %}selected{% endif %}>6b+</option>
                        <option class="font-option" value="6c" {% if climb.grade == '6c' %}selected{% endif %}>6c</option>
                        <option class="font-option" value="6c+" {% if climb.grade == '6c+' %}selected{% endif %}>6c+</option>
                        <option class="font-option" value="7a" {% if climb.grade == '7a' %}selected{% endif %}>7a</option>
                        <option class="font-option" value="7a+" {% if climb.grade == '7a+' %}selected{% endif %}>7a+</option>
                        <option class="font-option" value="7b" {% if climb.grade == '7b' %}selected{% endif %}>7b</option>
                        <option class="font-option" value="7b+" {% if climb.grade == '7b+' %}selected{% endif %}>7b+</option>
                        <option class="font-option" value="7c" {% if climb.grade == '7c' %}selected{% endif %}>7c</option>
                        <option class="font-option" value="7c+" {% if climb.grade == '7c+' %}selected{% endif %}>7c+</option>
                        <option class="font-option" value="8a" {% if climb.grade == '8a' %}selected{% endif %}>8a</option>
                        <option class="font-option" value="8a+" {% if climb.grade == '8a+' %}selected{% endif %}>8a+</option>
                        <option class="font-option" value="8b" {% if climb.grade == '8b' %}selected{% endif %}>8b</option>
                        <option class="font-option" value="8b+" {% if climb.grade == '8b+' %}selected{% endif %}>8b+</option>
                        <option class="font-option" value="8c" {% if climb.grade == '8c' %}selected{% endif %}>8c</option>
                        <option class="font-option" value="8c+" {% if climb.grade == '8c+' %}selected{% endif %}>8c+</option>
                        <option class="font-option" value="9a" {% if climb.grade == '9a' %}selected{% endif %}>9a</option>
                    </optgroup>
                    </select>
                    </div>

                    <div class="form-group">
                        <label for="edit_climb_description">Additional Notes:</label>
                        <textarea id="edit_climb_description" name="edit_climb_description" rows="3" placeholder="Any additional details about this climb...">{{ climb.description }}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="media_files">Media (Optional):</label>
                        <div class="file-upload-container">
                            <input type="file" id="media_files" name="media_files" multiple accept="image/*,video/*" style="display: none;">
                            <button type="button" id="add_media_btn" class="btn btn-outline">Add Photos/Videos</button>
                            <div id="selected_files" class="selected-files-list"></div>
                            <h3>
                            Photos and Videos
                        </h3>
                        {% if has_media %}
                            <div class="media-strip">
                                {% for media in media_files %}
                                    <div class="media-item">
                                        {% if media.mime.startswith('image/') %}
                                            <img src="{{ media.url }}" alt="{{ media.filename }}" class="media-thumb">
                                            <button type="button" class="remove-existing-media-btn" data-media-id="{{ media._id }}">Ã—</button>
                                        {% elif media.mime.startswith('video/') %}
                                        <div class="media-thumb video-wrapper">
                                            <video controls class="media-thumb" preload="none" {% if media.thumbnail %}poster="https://{{ media.thumbnail }}"{% endif %}>
                                                <source src="{{ media.url }}" type="{{ media.mime }}">
                                            </video>
                                        </div>
                                        <button type="button" class="remove-existing-media-btn" data-media-id="{{ media._id }}">Ã—</button>
                                        {% else %}
                                            <a href="{{ media.url }}" target="_blank">{{ media.filename }}</a>
                                            <button type="button" class="remove-existing-media-btn" data-media-id="{{ media._id }}">Ã—</button>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p>No media available for this climb.</p>
                        {% endif %}
                        </div>
                    </div>
                    <!-- Two-column row for attempts and completed -->
                    <div class="form-row-two-col">
                        <div class="form-group-inline">
                            <label for="edit_climb_attempts">Number of Attempts:</label>
                            <input type="number" id="edit_climb_attempts" name="edit_climb_attempts" min="1" value="{{ climb.attempts }}" required>
                        </div>
                        <div class="form-group-inline">
                            <label for="edit_climb_complete">Completed:</label>
                            <input type="checkbox" id="edit_climb_complete" name="edit_climb_complete" {% if climb.complete %}checked{% endif %}>
                        </div>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <a href="/user/my_tracker" class="btn btn-secondary">Cancel</a>
                            <button type="button" class="btn btn-danger" onclick="deleteTracker('{{ climb._id }}')">Delete Tracker</button>
                   
                    </div>
                </form>
            </div>
        </div>
        <div class="media-modal hidden" id="media-modal"> 
                <div class = "media-modal-background">
                </div>
                <div class = "media-modal-content">

                </div>
            </div>
    </div>

{% block extra_js %}


<script src="/static/js/upload.js">
</script>
<script src="/static/js/view_climb.js"></script>

{% endblock %}

{% endblock %}